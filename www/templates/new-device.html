<ion-view view-title="Tappt">
    <ion-nav-title>{{!model.id ? "New Device" : "Edit Device"}}</ion-nav-title>
    <ion-content ng-controller="NewDeviceCtrl">
        <form name="form" ng-submit="submitForm()" novalidate>
            <div class="list">
                <div class="form-errors" ng-if="errorDescription" data-ng-cloak>
                    <div class="form-error" ng-bind="errorDescription"></div>
                </div>
                <div class="list list-inset">
                    <label class="item item-input" ng-class="{ 'has-error' : form.name.$invalid || errors['model.Name']}">
                        <input type="text" ng-model="model.name" placeholder="Name" required>
                    </label>
                    <div class="form-errors" data-ng-repeat="error in errors['model.Name']" data-ng-cloak>
                        <div class="form-error" ng-bind="error"></div>
                    </div>

                    <label class="item item-input">
                        <i class="icon ion-chevron-right placeholder-icon" ng-show="!model.particleId || !particleIdLoaded"></i>
                        <i class="icon ion-checkmark balanced" ng-show="model.particleId && particleIdLoaded && particleIdValid"></i>
                        <i class="icon ion-alert energized" ng-show="model.particleId && particleIdLoaded && particleIdInUse"></i>
                        <i class="icon ion-alert-circled assertive" ng-show="model.particleId && particleIdLoaded && particleIdError"></i>
                        <input type="text"
                               ng-model="model.particleId"
                               class="form-control"
                               id="particleId"
                               name="particleId"
                               placeholder="Particle ID"
                               ng-change="getDeviceStatus()"
                               ng-disabled="model.id"
                               ng-model-options="{debounce: 1000}"
                               required ng-class="{ 'input-validation-error' : form.particleId.$dirty && !form.particleId.$valid || errors['model.ParticleId']}"
                               style="padding-left: 10px" />
                    </label>
                    <div class="form-errors" ng-show="model.particleId && particleIdLoaded && particleIdInUse">
                        <span class="form-error">
                            The particle device ID you entered is already in use.  Please contact an administrator if you think this is incorrect.
                        </span>
                    </div>
                    <div class="form-errors" ng-show="model.particleId && particleIdLoaded && particleIdError">
                        <span class="form-error">
                            The particle device ID you entered is not registered Tappt.  Please contact an administrator if you think this is incorrect.
                        </span>
                    </div>
                    <label class="item item-input item-select">
                        <div class="input-label">
                            Device Status
                        </div>
                        <select ng-model="statusModel" required ng-options="obj.text for obj in deviceStatusTypes track by obj.value"></select>
                    </label>
                    <label class="item">
                        <button class="button button-block button-positive" type="submit" ng-disabled="form.$invalid">
                            <span ng-if="!model.id">Sync Device</span>
                            <span ng-if="model.id">Update Device</span>
                        </button>
                    </label>
                </div>
            </div>
        </form>
    </ion-content>
</ion-view>
